{
    "parameters": {
        "disallowedVmSkus": {
            "type": "Array",
            "metadata": {
                "description": "List of disallowed VM sizes (SKUs).",
                "displayName": "Disallowed VM SKUs"
            },
            "defaultValue": [
                "Basic_A0",
                "Basic_A1",
                "Basic_A2",
                "Basic_A3",
                "Basic_A4",
                "Standard_A0",
                "Standard_A1",
                "Standard_A2",
                "Standard_A3",
                "Standard_A4",
                "Standard_A5",
                "Standard_A6",
                "Standard_A7",
                "Standard_L4s",
                "Standard_L8s",
                "Standard_L16s",
                "Standard_L32s",
                "Standard_NC6s_v3",
                "Standard_NC12s_v3",
                "Standard_NC24s_v3",
                "Standard_NC24rs_v3"
            ]
        }
    },
    "policyRule": {
        "if": {
            "anyOf": [
                {
                    "allOf": [
                        {
                            "field": "type",
                            "equals": "Microsoft.Compute/virtualMachines"
                        },
                        {
                            "field": "Microsoft.Compute/virtualMachines/sku.name",
                            "in": "[parameters('disallowedVmSkus')]"
                        }
                    ]
                },
                {
                    "allOf": [
                        {
                            "field": "type",
                            "equals": "Microsoft.Compute/virtualMachineScaleSets"
                        },
                        {
                            "field": "Microsoft.Compute/virtualMachineScaleSets/sku.name",
                            "in": "[parameters('disallowedVmSkus')]"
                        }
                    ]
                },
                {
                    "allOf": [
                        {
                            "field": "type",
                            "equals": "Microsoft.ContainerService/managedClusters"
                        },
                        {
                            "field": "Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].vmSize",
                            "in": "[parameters('disallowedVmSkus')]"
                        }
                    ]
                },
                {
                    "allOf": [
                        {
                            "field": "type",
                            "equals": "Microsoft.Batch/batchAccounts/pools"
                        },
                        {
                            "field": "Microsoft.Batch/batchAccounts/pools/vmSize",
                            "in": "[parameters('disallowedVmSkus')]"
                        }
                    ]
                }
            ]
        },
        "then": {
            "effect": "deny"
        }
    }
}